---
title: vue-router钩子执行顺序
date: 2021-03-20 15:24:24
permalink: /pages/b61db9/
categories:
  - 面试
  - Vue
tags:
  - Vue
---

# vue-router 钩子执行顺序

## 导航钩子分类

- 全局守卫
- 路由独享守卫
- 组件守卫

## 全局守卫

```js{2,7}
router.beforeEach((to, from, next) => {
  console.log('全局 - beforeEach')
  next() // 必须要有调用 next
})

router.afterEach(() => {
  console.log('全局 - afterEach')
})
```

## 路由独享守卫

```js{7,16}
{
  path: '/home',
  name: 'Home',
  component: () => import('../views/Home.vue'),
  beforeEnter (to, from , next) {
    next() // 必须要有调用 next
    console.log('路由 - beforeEnter ---> Home')
  }
},
{
  path: '/about',
  name: 'About',
  component: () => import('../views/About.vue'),
  beforeEnter (to, from, next) {
    next() // 必须要有调用 next
    console.log('路由 - beforeEnter ---> About')
  }
}
```

## 组件守卫

```js{3,7,14,19}
// Home 组件
beforeRouteEnter(to, from, next) {
  console.log('组件 - beforeRouteEnter ---> Home')
  next() // 必须要有调用 next
},
beforeRouteLeave(to, from, next) {
  console.log('组件 - beforeRouteLeave ---> Home')
  next() // 必须要有调用 next
},


// About 组件
beforeRouteEnter(to, from, next) {
  console.log('组件 - beforeRouteEnter ---> About')
  next()
},
beforeRouteLeave(to, from, next) {
  next()
  console.log('组件 - beforeRouteLeave ---> About')
}
```

## 顺序

从 `Home` 组件 跳转到 `About` 组件 依次输出

```{2,3,4,5}
- 组件 - beforeRouteLeave ---> Home
- 全局 - beforeEach
- 路由 - beforeEnter ---> About
- 组件 - beforeRouteEnter ---> About
- 全局 - afterEach
```

假设，一打开页面就进入 `Home` 页面，此时的钩子顺序 如下

```{1,2,3,4}
- 全局 - beforeEach
- 路由 - beforeEnter ---> Home
- 组件 - beforeRouteEnter ---> Home
- 全局 - afterEach
```

综合上诉两种情况，我们可以得出如下结论

- 如果是第一次进入页面，依次执行 `全局的进入前置钩子` -> `路由的进入钩子` -> `组件的进入钩子` -> `全局的进入后置钩子`
- 如果从组件内离开，将会优先执行组件的 `beforeRouteLeave` 钩子，此后依次执行 `全局的进入前置钩子` -> `路由的进入钩子` -> `组件的进入钩子` -> `全局的进入后置钩子`
- 顺序依次为： 组件离开(可有可无) -> 全局 -> 路由 -> 组件 -> 全局
